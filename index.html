<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>G-COMMANDER V6.0 | æœ€ç»ˆç¨³å®šç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .hidden { display: none !important; }
        .active-mode { background: #4f46e5 !important; color: white !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans h-screen flex flex-col overflow-hidden">

    <nav class="bg-indigo-600 text-white p-4 flex justify-between items-center shrink-0 shadow-lg">
        <div class="flex items-center space-x-2">
            <span class="font-black text-xl cursor-pointer" onclick="location.reload()">G-COMMANDER V6.0</span>
        </div>
        <div class="flex space-x-4">
            <button onclick="openModal('nbModal')" class="font-bold">ğŸ“• ç”Ÿè¯ <span id="nbCount">0</span></button>
            <button onclick="openModal('sbModal')" class="font-bold">â˜ ï¸ é¡½å›º <span id="sbCount">0</span></button>
        </div>
    </nav>

    <main class="flex-grow flex flex-col items-center justify-center p-4">
        
        <div id="home" class="w-full max-w-md bg-white p-8 rounded-[2rem] shadow-xl text-center space-y-6">
            <h2 class="text-2xl font-black">æ‰§è¡Œç¯å¢ƒå°±ç»ª</h2>
            <div id="resumeBox" class="hidden p-4 bg-amber-50 rounded-xl flex justify-between items-center border border-amber-200">
                <span id="resumeText" class="text-xs font-bold text-amber-700">å‘ç°æœªå®Œæˆè¿›åº¦</span>
                <button onclick="resume()" class="bg-amber-600 text-white text-[10px] px-3 py-1 rounded-lg">ç»§ç»­</button>
            </div>
            <label class="block border-4 border-dashed border-slate-100 p-10 rounded-3xl hover:border-indigo-500 cursor-pointer transition">
                <input type="file" id="fileIn" class="hidden" accept=".xlsx, .xls">
                <span class="text-4xl block mb-2">ğŸ“‚</span>
                <span class="font-bold">ç‚¹å‡»ä¸Šä¼  805 è¯è¡¨</span>
            </label>
        </div>

        <div id="study" class="hidden w-full max-w-xl space-y-4">
            <div class="flex justify-between items-center px-4">
                <button onclick="location.reload()" class="text-xs font-bold text-slate-400 uppercase">â† è¿”å›é¦–é¡µ</button>
                <div class="flex space-x-1">
                    <button id="mQuick" onclick="switchM('quick')" class="px-3 py-1 text-[10px] font-bold rounded bg-slate-200">æé€Ÿ</button>
                    <button id="mDeep" onclick="switchM('deep')" class="px-3 py-1 text-[10px] font-bold rounded bg-slate-200">æ·±åº¦</button>
                </div>
            </div>

            <div class="bg-white p-10 rounded-[3rem] shadow-2xl relative">
                <div id="pBar" class="absolute top-0 left-0 h-1 bg-indigo-500 transition-all rounded-full" style="width:0%"></div>
                <div class="text-center">
                    <p id="posText" class="text-[10px] font-black text-slate-300 mb-4 uppercase tracking-widest">0 / 0</p>
                    <h3 id="qText" class="text-4xl font-black mb-10 text-slate-800">åŠ è½½ä¸­...</h3>
                    
                    <div class="space-y-4 max-w-xs mx-auto">
                        <input type="text" id="i1" class="w-full border-b-4 border-slate-100 py-3 text-3xl focus:outline-none focus:border-indigo-500 text-center font-bold" placeholder="ç­‰å¾…è¾“å…¥..." autocomplete="off">
                        <input type="text" id="i2" class="hidden w-full border-b-4 border-slate-100 py-3 text-3xl focus:outline-none focus:border-indigo-500 text-center font-bold" placeholder="è¾“å…¥æ±‰å­—" autocomplete="off">
                    </div>
                    
                    <p id="msg" class="h-4 mt-4 text-xs font-bold"></p>
                </div>
                
                <div class="mt-10 flex space-x-3">
                    <button id="btnSub" onclick="verify()" class="flex-grow bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-lg active:scale-95 transition">æäº¤éªŒè¯</button>
                    <button id="btnNext" onclick="nextW()" class="hidden flex-grow bg-emerald-500 text-white font-black py-4 rounded-2xl shadow-lg">ä¸‹ä¸€ä¸ª</button>
                </div>
            </div>
        </div>
    </main>

    <div id="nbModal" class="hidden fixed inset-0 bg-slate-900/60 flex items-center justify-center p-4 z-[100]">
        <div class="bg-white w-full max-w-lg rounded-3xl max-h-[80vh] flex flex-col">
            <div class="p-6 border-b flex justify-between font-black"><h3>ğŸ“• ç”Ÿè¯è®°å½•</h3><button onclick="closeModal('nbModal')">âœ•</button></div>
            <div id="nbList" class="p-4 overflow-y-auto flex-grow text-xs space-y-2"></div>
            <div class="p-6 bg-slate-50 flex space-x-3">
                <button onclick="instant('nb')" class="flex-grow bg-indigo-600 text-white font-black py-3 rounded-xl">âš”ï¸ çªå‡»å¤ä¹ </button>
                <button onclick="exportNB()" class="bg-white border px-4 rounded-xl font-bold">å¯¼å‡º</button>
            </div>
        </div>
    </div>

    <div id="sbModal" class="hidden fixed inset-0 bg-slate-900/60 flex items-center justify-center p-4 z-[100]">
        <div class="bg-white w-full max-w-lg rounded-3xl max-h-[80vh] flex flex-col">
            <div class="p-6 border-b flex justify-between font-black"><h3>â˜ ï¸ é¡½å›ºç‚¹ä½</h3><button onclick="closeModal('sbModal')">âœ•</button></div>
            <div id="sbList" class="p-4 overflow-y-auto flex-grow text-xs space-y-2"></div>
            <div class="p-6 bg-slate-50"><button onclick="instant('sb')" class="w-full bg-slate-800 text-white font-black py-3 rounded-xl">âš”ï¸ ç«‹å³æ¸…å‰¿</button></div>
        </div>
    </div>

    <script>
        let queue = [], idx = 0, cur = null, mode = 'deep';
        let nb = JSON.parse(localStorage.getItem('gina_nb')) || [];
        let sb = JSON.parse(localStorage.getItem('gina_sb')) || [];

        // åˆå§‹åŒ–
        window.onload = () => { updateUI(); checkResume(); switchM('deep'); };

        // æ–‡ä»¶ä¸Šä¼ æ ¸å¿ƒ
        document.getElementById('fileIn').onchange = (e) => {
            const f = e.target.files[0];
            const r = new FileReader();
            r.onload = (ev) => {
                const wb = XLSX.read(new Uint8Array(ev.target.result), {type:'array'});
                const data = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], {header:1});
                queue = data.slice(1).map(row => {
                    let w = String(row[0]||"").trim(), rd = String(row[1]||"").trim(), m = String(row[2]||"").trim();
                    if(!w) return null;
                    let hasK = /[\u4E00-\u9FAF]/.test(w);
                    return { word: w, reading: hasK ? rd : w, meaning: m || rd, isK: hasK };
                }).filter(x => x);
                if(queue.length) { queue.sort(()=>Math.random()-0.5); idx=0; go(); }
            };
            r.readAsArrayBuffer(f);
        };

        function go() {
            document.getElementById('home').classList.add('hidden');
            document.getElementById('study').classList.remove('hidden');
            load();
        }

        function switchM(m) {
            mode = m;
            document.getElementById('mQuick').className = (m === 'quick' ? 'active-mode' : '') + ' px-3 py-1 text-[10px] font-bold rounded bg-slate-200';
            document.getElementById('mDeep').className = (m === 'deep' ? 'active-mode' : '') + ' px-3 py-1 text-[10px] font-bold rounded bg-slate-200';
            if(cur) updateUI_Input();
        }

        function load() {
            if(idx >= queue.length) { 
                document.getElementById('study').innerHTML = `<div class="text-center p-10 bg-white rounded-3xl shadow-xl font-black text-2xl">ğŸ‰ æ‰§è¡Œå®Œæ¯•ï¼<br><button onclick="location.reload()" class="mt-6 text-sm bg-indigo-600 text-white px-6 py-2 rounded-xl">å›åˆ°é¦–é¡µ</button></div>`;
                localStorage.removeItem('gina_snap');
                return; 
            }
            cur = queue[idx];
            document.getElementById('qText').innerText = cur.meaning;
            document.getElementById('posText').innerText = `${idx + 1} / ${queue.length}`;
            document.getElementById('pBar').style.width = (idx/queue.length*100) + '%';
            
            updateUI_Input();
            document.getElementById('msg').innerText = '';
            document.getElementById('btnSub').classList.remove('hidden');
            document.getElementById('btnNext').classList.add('hidden');
            document.getElementById('i1').focus();
            localStorage.setItem('gina_snap', JSON.stringify({q:queue, i:idx, m:mode}));
        }

        function updateUI_Input() {
            document.getElementById('i1').value = '';
            document.getElementById('i2').value = '';
            document.getElementById('i1').disabled = false;
            document.getElementById('i2').classList.add('hidden');
            document.getElementById('i1').placeholder = (mode==='deep' && cur.isK) ? "è¾“å…¥è¯»éŸ³ (å‡å)" : "è¾“å…¥æ‹¼å†™";
        }

        function verify() {
            const v1 = document.getElementById('i1').value.trim().toLowerCase();
            const v2 = document.getElementById('i2').value.trim().toLowerCase();
            const s2Active = !document.getElementById('i2').classList.contains('hidden');

            if(!s2Active) {
                let target = (mode==='deep' && cur.isK) ? cur.reading : cur.word;
                if(v1 === target.toLowerCase()) {
                    if(mode==='deep' && cur.isK) {
                        document.getElementById('i2').classList.remove('hidden');
                        document.getElementById('i1').disabled = true;
                        document.getElementById('i2').focus();
                    } else { win(); }
                } else { fail(target); }
            } else {
                if(v2 === cur.word.toLowerCase()) { win(); } else { fail(cur.word); }
            }
        }

        function win() {
            document.getElementById('msg').innerText = "âœ“ ç›®æ ‡è¾¾æˆ";
            document.getElementById('msg').className = "h-4 mt-4 text-xs font-black text-emerald-500";
            document.getElementById('btnSub').classList.add('hidden');
            document.getElementById('btnNext').classList.remove('hidden');
            idx++;
        }

        function fail(t) {
            document.getElementById('msg').innerText = `âŒ é”™è¯¯ (æç¤º: ${t})`;
            document.getElementById('msg').className = "h-4 mt-4 text-xs font-black text-red-500";
            if(!nb.find(x => x.word === cur.word)) {
                nb.unshift(cur);
                localStorage.setItem('gina_nb', JSON.stringify(nb));
                updateUI();
            }
        }

        function nextW() { load(); }

        // å›è½¦ç›‘å¬ï¼ˆä¿®å¤ç„¦ç‚¹å’Œå†’æ³¡ï¼‰
        document.onkeydown = (e) => {
            if(e.key === 'Enter') {
                if(!document.getElementById('btnNext').classList.contains('hidden')) { nextW(); }
                else if(!document.getElementById('study').classList.contains('hidden')) { verify(); }
            }
        };

        // ç”Ÿè¯/é¡½å›ºé€»è¾‘
        function instant(type) {
            let data = (type === 'nb') ? nb : sb;
            if(!data.length) return;
            queue = [...data].sort(()=>Math.random()-0.5);
            idx = 0;
            closeModal(type + 'Modal');
            go();
        }

        function updateUI() {
            document.getElementById('nbCount').innerText = nb.length;
            document.getElementById('sbCount').innerText = sb.length;
            render('nbList', nb, 'nb');
            render('sbList', sb, 'sb');
        }

        function render(id, data, t) {
            const box = document.getElementById(id); box.innerHTML = '';
            data.forEach((x, i) => {
                const d = document.createElement('div');
                d.className = "flex justify-between p-2 border-b items-center";
                d.innerHTML = `<div><b>${x.word}</b> <span class="text-slate-400">${x.reading}</span><p class="opacity-50">${x.meaning}</p></div>
                               <button onclick="del(${i},'${t}')" class="text-indigo-600 font-bold">æŒæ¡</button>`;
                box.appendChild(d);
            });
        }

        function del(i, t) {
            if(t==='nb') nb.splice(i,1); else sb.splice(i,1);
            localStorage.setItem('gina_nb', JSON.stringify(nb));
            localStorage.setItem('gina_sb', JSON.stringify(sb));
            updateUI();
        }

        function checkResume() {
            const s = localStorage.getItem('gina_snap');
            if(s) { document.getElementById('resumeBox').classList.remove('hidden'); }
        }

        function resume() {
            const d = JSON.parse(localStorage.getItem('gina_snap'));
            queue = d.q; idx = d.i; mode = d.m || 'deep'; switchM(mode); go();
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function exportNB() {
            const ws = XLSX.utils.json_to_sheet(nb);
            const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Vocab");
            XLSX.writeFile(wb, `Gina_Words.xlsx`);
        }
    </script>
</body>
</html>
