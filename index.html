<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-COMMANDER V5.6 | æ—¥è¯­æ·±åº¦ä¼˜åŒ–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Inter', -apple-system, sans-serif; background: #f4f7fb; }
        .hidden-section { display: none; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <nav class="bg-indigo-600 text-white p-4 shadow-xl flex justify-between items-center z-50 shrink-0">
        <div class="flex items-center space-x-3">
            <span class="font-black text-2xl tracking-tighter cursor-pointer" onclick="goHome()">G-COMMANDER</span>
            <span class="text-[10px] bg-indigo-500 px-2 py-0.5 rounded-full font-bold">V5.6</span>
        </div>
        <div class="flex space-x-6 text-sm font-black">
            <button onclick="toggleModal('stubbornModal')" class="hover:text-indigo-200 transition">â˜ ï¸ é¡½å›º <span id="navStubborn" class="bg-slate-800 px-1.5 rounded ml-1">0</span></button>
            <button onclick="toggleModal('notebookModal')" class="hover:text-indigo-200 transition">ğŸ“• ç”Ÿè¯ <span id="navVocab" class="bg-white text-indigo-600 px-1.5 rounded ml-1">0</span></button>
        </div>
    </nav>

    <main class="flex-grow overflow-y-auto p-4 md:p-8 flex flex-col items-center">
        
        <div id="homeSection" class="w-full max-w-4xl space-y-8 fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-gradient-to-br from-indigo-600 to-purple-700 p-8 rounded-[2.5rem] text-white shadow-2xl flex flex-col justify-between">
                    <div>
                        <p class="text-[10px] font-black opacity-60 uppercase tracking-widest mb-1">JLPT 2026 Battle</p>
                        <div class="text-7xl font-black mb-4" id="countdown">---</div>
                        <p class="text-sm italic border-l-2 border-indigo-400 pl-4 py-1" id="motto">"æ‰§è¡Œç›®æ ‡ï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨è®¡åˆ’ã€‚"</p>
                    </div>
                    <div class="mt-8 bg-indigo-500/30 p-4 rounded-2xl">
                        <p class="text-[10px] font-black mb-1 uppercase text-indigo-200">ä»Šæ—¥ç†æ€§æç¤º</p>
                        <p id="todayTip" class="text-xs font-bold leading-relaxed">å±è”½æƒ…ç»ªè¯¯å¯¼ï¼Œç”¨ç†æ€§æ¥çœ‹å¾…æ‰€æœ‰äº‹æƒ…ã€‚</p>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-slate-100 flex flex-col">
                    <h3 class="font-black text-xl mb-6">é…ç½®ä»»åŠ¡ç¯å¢ƒ</h3>
                    
                    <div class="mb-6 space-y-3">
                        <label class="text-[10px] font-black text-slate-400 uppercase">é€‰æ‹©è®­ç»ƒå¼ºåº¦</label>
                        <select id="studyMode" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-sm border-none focus:ring-2 focus:ring-indigo-500">
                            <option value="deep">æ·±åº¦æ¨¡å¼ (æ±‰å­—å•è¯è¦æ±‚è¾“å…¥è¯»éŸ³+å†™æ³•)</option>
                            <option value="quick">æé€Ÿæ¨¡å¼ (ç›´æ¥è¾“å…¥å•è¯æœ¬èº«)</option>
                        </select>
                    </div>

                    <div id="resumeBox" class="hidden-section mb-6 p-4 bg-amber-50 border border-amber-100 rounded-2xl flex justify-between items-center">
                        <span id="resumeInfo" class="text-[10px] font-black text-amber-600"></span>
                        <button onclick="resumeStudy()" class="text-[10px] font-black bg-amber-500 text-white px-3 py-1.5 rounded-lg">ç»§ç»­æ‰§è¡Œ</button>
                    </div>

                    <label class="flex-grow flex flex-col items-center justify-center border-2 border-dashed border-slate-200 rounded-[2rem] hover:border-indigo-400 transition cursor-pointer p-6">
                        <input type="file" id="fileInput" class="hidden" accept=".xlsx, .xls" />
                        <span class="text-4xl mb-2">ğŸ“‚</span>
                        <span class="font-black text-slate-800">å¯¼å…¥å•è¯è¡¨</span>
                        <span class="text-[10px] text-slate-400 font-bold mt-1">SUPPORTING 2-COLUMN & 3-COLUMN</span>
                    </label>
                </div>
            </div>
        </div>

        <div id="studySection" class="hidden-section w-full max-w-xl fade-in pt-4">
            <div class="flex justify-between items-center mb-6">
                <button onclick="goHome()" class="bg-white px-4 py-2 rounded-xl shadow-sm text-[10px] font-black text-slate-500 hover:text-indigo-600 transition">â† è¿”å›æŒ‡æŒ¥éƒ¨</button>
                <div class="text-right">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest"><span id="remainCount">0</span> / <span id="totalCount">0</span></p>
                </div>
            </div>

            <div class="bg-white rounded-[3rem] shadow-2xl min-h-[480px] flex flex-col relative border border-slate-100 overflow-hidden">
                <div id="progressBar" class="absolute top-0 left-0 h-1.5 bg-indigo-500 transition-all duration-500" style="width: 0%"></div>
                <button onclick="openEditModal()" class="absolute top-8 right-8 text-slate-200 hover:text-indigo-500 transition text-xl">âœï¸</button>

                <div class="p-12 text-center flex-grow flex flex-col justify-center">
                    <div id="wordTag" class="inline-block mx-auto px-3 py-1 rounded-full bg-indigo-50 text-indigo-500 text-[9px] font-black mb-4 uppercase tracking-tighter">IDENTIFYING...</div>
                    <h2 id="questionText" class="text-5xl font-black text-slate-800 mb-10 leading-tight">åŠ è½½ä¸­...</h2>

                    <div class="space-y-6 max-w-xs mx-auto w-full">
                        <div id="step1">
                            <p id="step1Label" class="text-[10px] font-black text-slate-400 mb-2 uppercase">Input Reading / è¯»éŸ³</p>
                            <input type="text" id="input1" class="w-full border-b-4 border-slate-100 py-3 text-3xl focus:outline-none focus:border-indigo-500 text-center font-bold transition-all" autocomplete="off">
                        </div>
                        <div id="step2" class="hidden-section">
                            <p class="text-[10px] font-black text-slate-400 mb-2 uppercase">Input Writing / æ±‰å­—å†™æ³•</p>
                            <input type="text" id="input2" class="w-full border-b-4 border-slate-100 py-3 text-3xl focus:outline-none focus:border-indigo-500 text-center font-bold transition-all" autocomplete="off">
                        </div>
                        <p id="feedback" class="text-[11px] font-black mt-4 h-4"></p>
                    </div>
                </div>

                <div class="p-8 bg-slate-50 flex space-x-4">
                    <button id="btnSubmit" onclick="handleAction()" class="flex-grow bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-lg active:scale-95 transition text-lg">ç¡®è®¤æäº¤ (Enter)</button>
                    <button id="btnNext" onclick="loadNextWord()" class="hidden-section flex-grow bg-emerald-500 text-white font-black py-5 rounded-2xl shadow-lg transition text-lg">ä¸‹ä¸€ä¸ªè¯ (Enter)</button>
                </div>
            </div>
        </div>

        <div id="finishSection" class="hidden-section w-full max-w-md bg-white p-12 rounded-[3rem] shadow-2xl text-center fade-in">
            <div class="text-7xl mb-6">ğŸ†</div>
            <h2 class="text-3xl font-black mb-4">æ‰§è¡Œå®Œæ¯•</h2>
            <p class="text-slate-400 font-bold text-sm mb-10 tracking-tight">ä»Šå¤©çš„ç†æ€§æˆ˜èƒœäº†æ€ æƒ°ã€‚</p>
            <button onclick="goHome()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-xl">è¿”å›å¤§æœ¬è¥</button>
        </div>

    </main>

    <div id="notebookModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4">
        <div class="bg-white rounded-[2.5rem] w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl overflow-hidden">
            <div class="p-6 bg-slate-50 border-b flex justify-between items-center">
                <h3 class="font-black text-xl">ğŸ“• Gina çš„ç”Ÿè¯èµ„äº§</h3>
                <button onclick="toggleModal('notebookModal')" class="text-2xl font-black">&times;</button>
            </div>
            <div class="p-4 overflow-y-auto flex-grow">
                <table class="w-full text-left text-sm">
                    <thead><tr class="text-[10px] text-slate-400 border-b uppercase font-black"><th class="pb-2">è¯æ¡</th><th class="pb-2">è§£æ</th><th class="pb-2 text-right">æ“ä½œ</th></tr></thead>
                    <tbody id="notebookList"></tbody>
                </table>
            </div>
            <div class="p-6 border-t bg-slate-50 flex justify-between">
                <button onclick="exportExcel()" class="text-indigo-600 font-black text-xs">ğŸ“¥ å¤‡ä»½åˆ° EXCEL</button>
                <button onclick="toggleModal('notebookModal')" class="bg-indigo-600 text-white px-8 py-2 rounded-xl font-black text-xs">æ‰§è¡Œå®Œæ¯•</button>
            </div>
        </div>
    </div>

    <div id="stubbornModal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4">
        <div class="bg-white rounded-[2.5rem] w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl overflow-hidden border-4 border-slate-800">
            <div class="p-6 bg-slate-800 text-white flex justify-between items-center">
                <h3 class="font-black text-xl">â˜ ï¸ é¡½å›ºç‚¹ä½</h3>
                <button onclick="toggleModal('stubbornModal')" class="text-2xl font-black">&times;</button>
            </div>
            <div class="p-4 overflow-y-auto flex-grow"><table class="w-full text-left text-sm"><tbody id="stubbornList"></tbody></table></div>
        </div>
    </div>

    <div id="editModal" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[200] p-4">
        <div class="bg-white rounded-[2.5rem] w-full max-w-sm p-8 shadow-2xl">
            <h3 class="font-black text-xl mb-6">âœï¸ ä¿®æ­£è¯æ¡</h3>
            <div class="space-y-4">
                <div><label class="text-[10px] font-black text-slate-400 block mb-1">å«ä¹‰</label><input id="editMeaning" class="w-full bg-slate-50 p-4 rounded-xl font-bold border"></div>
                <div><label class="text-[10px] font-black text-slate-400 block mb-1">æ‹¼å†™/æ±‰å­—</label><input id="editWord" class="w-full bg-slate-50 p-4 rounded-xl font-bold border"></div>
                <div><label class="text-[10px] font-black text-slate-400 block mb-1">è¯»éŸ³ (å‡å)</label><input id="editReading" class="w-full bg-slate-50 p-4 rounded-xl font-bold border"></div>
            </div>
            <div class="flex space-x-3 mt-8"><button onclick="saveEdit()" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-black">ä¿å­˜ä¿®æ”¹</button><button onclick="toggleModal('editModal')" class="flex-1 bg-slate-100 text-slate-400 py-4 rounded-2xl font-black">å–æ¶ˆ</button></div>
        </div>
    </div>

    <script>
        let studyQueue = [], currentIndex = 0, currentWord = null;
        let vocabNotebook = JSON.parse(localStorage.getItem('gina_vocab_notebook')) || [];
        let stubbornNotebook = JSON.parse(localStorage.getItem('gina_stubborn_notebook')) || [];
        
        const tips = ["æ‰§è¡Œç›®æ ‡ï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨è®¡åˆ’ã€‚", "å…ˆéš¾åæ˜“ï¼Œè§£å†³é—®é¢˜ã€‚", "å±è”½æƒ…ç»ªçš„è¯¯å¯¼ï¼Œç”¨ç†æ€§çœ‹å¾…ã€‚", "æ‹…å¾—èµ·è´£ä»»äºŒå­—ã€‚", "ä¸è¦è‡ªå‘ã€‚"];

        window.onload = () => {
            updateCountdown();
            updateNotebookUI();
            checkResume();
            document.getElementById('motto').innerText = tips[Math.floor(Math.random()*tips.length)];
            document.getElementById('todayTip').innerText = tips[Math.floor(Math.random()*tips.length)];
        };

        function updateCountdown() {
            const days = Math.ceil((new Date('2026-07-05') - new Date()) / (1000*60*60*24));
            document.getElementById('countdown').innerText = days > 0 ? days : "GO!";
        }

        // --- æ™ºèƒ½è§£æå¼•æ“ (é’ˆå¯¹ A/B/C ä¸‰ç§æƒ…å†µ) ---
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = (ev) => {
                const workbook = XLSX.read(new Uint8Array(ev.target.result), {type: 'array'});
                const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});
                
                studyQueue = rows.slice(1).map(row => {
                    let a = String(row[0]||"").trim(); // å•è¯
                    let b = String(row[1]||"").trim(); // è¯»éŸ³ æˆ– å«ä¹‰
                    let c = String(row[2]||"").trim(); // å«ä¹‰
                    
                    let hasK = /[\u4E00-\u9FAF]/.test(a); // æ£€æŸ¥ A åˆ—æ˜¯å¦æœ‰æ±‰å­—
                    
                    return {
                        word: a,
                        reading: hasK ? b : a, // å¦‚æœå«æ±‰å­—ï¼ŒB æ˜¯è¯»éŸ³ï¼›å¦‚æœä¸å«ï¼Œè¯»éŸ³å°±æ˜¯ A æœ¬èº«
                        meaning: c || b,       // å¦‚æœæœ‰ Cï¼ŒC æ˜¯å«ä¹‰ï¼›æ²¡æœ‰ Cï¼ŒB å°±æ˜¯å«ä¹‰
                        isKanji: hasK
                    };
                }).filter(i => i.word);
                
                studyQueue.sort(() => Math.random() - 0.5);
                currentIndex = 0;
                startStudy();
            };
            reader.readAsArrayBuffer(file);
        });

        function startStudy() {
            document.getElementById('homeSection').classList.add('hidden-section');
            document.getElementById('studySection').classList.remove('hidden-section');
            document.getElementById('totalCount').innerText = studyQueue.length;
            loadNextWord();
        }

        function loadNextWord() {
            if (currentIndex >= studyQueue.length) { showFinish(); return; }
            currentWord = studyQueue[currentIndex];
            const mode = document.getElementById('studyMode').value;

            document.getElementById('questionText').innerText = currentWord.meaning;
            document.getElementById('remainCount').innerText = currentIndex + 1;
            document.getElementById('progressBar').style.width = `${(currentIndex/studyQueue.length)*100}%`;
            
            // UI é‡ç½®
            document.getElementById('input1').value = '';
            document.getElementById('input2').value = '';
            document.getElementById('input1').disabled = false;
            document.getElementById('step2').classList.add('hidden-section');
            document.getElementById('btnSubmit').classList.remove('hidden-section');
            document.getElementById('btnNext').classList.add('hidden-section');
            document.getElementById('feedback').innerText = '';

            // é€»è¾‘åˆ†æ”¯ï¼šå¦‚æœæ˜¯çº¯å‡åï¼Œæˆ–è€…æé€Ÿæ¨¡å¼ï¼Œåªéœ€è¾“å…¥ä¸€æ­¥
            if (!currentWord.isKanji || mode === 'quick') {
                document.getElementById('wordTag').innerText = "KANA / æ‹¼å†™æ¨¡å¼";
                document.getElementById('step1Label').innerText = "è¾“å…¥å•è¯æ‹¼å†™";
            } else {
                document.getElementById('wordTag').innerText = "KANJI / æ·±åº¦æ¨¡å¼";
                document.getElementById('step1Label').innerText = "Step 1: è¾“å…¥è¯»éŸ³ (å‡å)";
            }

            setTimeout(() => document.getElementById('input1').focus(), 50);
            localStorage.setItem('gina_v56_snapshot', JSON.stringify({q: studyQueue, i: currentIndex}));
        }

        function handleAction() {
            const val1 = document.getElementById('input1').value.trim().toLowerCase();
            const val2 = document.getElementById('input2').value.trim().toLowerCase();
            const mode = document.getElementById('studyMode').value;
            const isStep2 = !document.getElementById('step2').classList.contains('hidden-section');

            if (!isStep2) {
                // ç¬¬ä¸€é˜¶æ®µéªŒè¯
                let target = (currentWord.isKanji && mode === 'deep') ? currentWord.reading : currentWord.word;
                if (val1 === target.toLowerCase()) {
                    if (currentWord.isKanji && mode === 'deep') {
                        document.getElementById('step2').classList.remove('hidden-section');
                        document.getElementById('input1').disabled = true;
                        document.getElementById('input2').focus();
                        showFeedback("âœ“ è¯»éŸ³æ­£ç¡®ï¼Œè¯·è¾“å…¥æ±‰å­—å†™æ³•", "text-indigo-600");
                    } else { pass(); }
                } else { showFeedback(`âŒ æ‹¼å†™ä¸åŒ¹é… (æç¤º: ${target})`, "text-red-500"); recordError(); }
            } else {
                // ç¬¬äºŒé˜¶æ®µéªŒè¯ (æ±‰å­—)
                if (val2 === currentWord.word.toLowerCase()) { pass(); }
                else { showFeedback(`âŒ æ±‰å­—ä¹¦å†™é”™è¯¯ (æ­£ç¡®: ${currentWord.word})`, "text-red-500"); recordError(); }
            }
        }

        function pass() {
            showFeedback("ğŸ‰ æ‰§è¡Œæ­£ç¡®", "text-emerald-500");
            currentIndex++;
            document.getElementById('btnSubmit').classList.add('hidden-section');
            document.getElementById('btnNext').classList.remove('hidden-section').focus();
        }

        function recordError() {
            if (!vocabNotebook.find(i => i.word === currentWord.word)) {
                vocabNotebook.unshift(currentWord);
                localStorage.setItem('gina_vocab_notebook', JSON.stringify(vocabNotebook));
                updateNotebookUI();
            }
        }

        // --- æ•°æ®æ¢å¤ä¸æŠ¢æ•‘é€»è¾‘ ---
        function updateNotebookUI() {
            document.getElementById('navVocab').innerText = vocabNotebook.length;
            document.getElementById('navStubborn').innerText = stubbornNotebook.length;
            renderList('notebookList', vocabNotebook, 'v');
            renderList('stubbornList', stubbornNotebook, 's');
        }

        function renderList(id, data, type) {
            const el = document.getElementById(id); el.innerHTML = '';
            data.forEach((w, i) => {
                // ã€æ ¸å¿ƒï¼šå¤šç‰ˆæœ¬æ•°æ®å…¼å®¹è¡¥ä¸ã€‘
                let word = w.word || w.kanji || "æœªçŸ¥è¯";
                let mean = w.meaning || w.mean || w.translation || "å¾…è§£æ";
                let read = w.reading || w.kana || "";

                const tr = document.createElement('tr');
                tr.className = "border-b hover:bg-slate-50 transition";
                tr.innerHTML = `
                    <td class="py-4 font-black">${word} <span class="text-[10px] text-slate-300 ml-1">${read}</span></td>
                    <td class="py-4 text-xs italic text-slate-400">${mean}</td>
                    <td class="py-4 text-right"><button onclick="delWord(${i},'${type}')" class="text-indigo-600 font-bold">æŒæ¡</button></td>
                `;
                el.appendChild(tr);
            });
        }

        function delWord(i, t) {
            if(t === 'v') vocabNotebook.splice(i,1); else stubbornNotebook.splice(i,1);
            localStorage.setItem('gina_vocab_notebook', JSON.stringify(vocabNotebook));
            localStorage.setItem('gina_stubborn_notebook', JSON.stringify(stubbornNotebook));
            updateNotebookUI();
        }

        function checkResume() {
            const s = localStorage.getItem('gina_v56_snapshot');
            if(s) {
                const d = JSON.parse(s);
                document.getElementById('resumeBox').classList.remove('hidden-section');
                document.getElementById('resumeInfo').innerText = `ä¸Šæ¬¡è¿›åº¦: ${d.i}/${d.q.length}`;
            }
        }

        function resumeStudy() {
            const d = JSON.parse(localStorage.getItem('gina_v56_snapshot'));
            studyQueue = d.q; currentIndex = d.i; startStudy();
        }

        function goHome() {
            document.getElementById('homeSection').classList.remove('hidden-section');
            document.getElementById('studySection').classList.add('hidden-section');
            document.getElementById('finishSection').classList.add('hidden-section');
            checkResume();
        }

        function showFinish() {
            document.getElementById('studySection').classList.add('hidden-section');
            document.getElementById('finishSection').classList.remove('hidden-section');
            localStorage.removeItem('gina_v56_snapshot');
        }

        function openEditModal() {
            document.getElementById('editMeaning').value = currentWord.meaning;
            document.getElementById('editWord').value = currentWord.word;
            document.getElementById('editReading').value = currentWord.reading;
            toggleModal('editModal');
        }

        function saveEdit() {
            currentWord.meaning = document.getElementById('editMeaning').value;
            currentWord.word = document.getElementById('editWord').value;
            currentWord.reading = document.getElementById('editReading').value;
            currentWord.isKanji = /[\u4E00-\u9FAF]/.test(currentWord.word);
            toggleModal('editModal');
            loadNextWord();
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function showFeedback(t, c) { const f = document.getElementById('feedback'); f.innerText = t; f.className = `text-[11px] font-black mt-4 ${c}`; }
        function exportExcel() {
            const ws = XLSX.utils.json_to_sheet(vocabNotebook);
            const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Vocab");
            XLSX.writeFile(wb, `Gina_Words_${new Date().toLocaleDateString()}.xlsx`);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                if (!document.getElementById('btnNext').classList.contains('hidden-section')) loadNextWord();
                else if (!document.getElementById('studySection').classList.contains('hidden-section')) handleAction();
            }
        });
    </script>
</body>
</html>
