<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>G-COMMANDER V6.3 | ç»ˆææ•´åˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.2); }
        .hidden { display: none !important; }
        .active-mode { background: #4f46e5 !important; color: white !important; }
        .card-shadow { box-shadow: 0 20px 50px -12px rgba(79, 70, 229, 0.2); }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <nav class="bg-indigo-600 text-white p-4 shadow-xl flex justify-between items-center z-50">
        <div class="flex items-center space-x-3">
            <span class="font-black text-2xl tracking-tighter cursor-pointer" onclick="location.reload()">G-COMMANDER</span>
            <span class="text-[10px] bg-indigo-500 px-2 py-0.5 rounded-full font-bold">V6.3 FINAL</span>
        </div>
        <div class="flex space-x-6 text-sm font-black">
            <button onclick="toggleM('sbM')" class="hover:text-indigo-200 transition">â˜ ï¸ é¡½å›º <span id="sC" class="bg-slate-800 px-1.5 rounded ml-1">0</span></button>
            <button onclick="toggleM('nbM')" class="hover:text-indigo-200 transition">ğŸ“• ç”Ÿè¯ <span id="nC" class="bg-white text-indigo-600 px-1.5 rounded ml-1">0</span></button>
        </div>
    </nav>

    <main class="flex-grow overflow-y-auto p-6 md:p-12 flex flex-col items-center">
        
        <div id="hS" class="w-full max-w-5xl space-y-8 animate-in fade-in duration-500">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-gradient-to-br from-indigo-600 to-purple-700 p-10 rounded-[3rem] text-white card-shadow flex flex-col justify-between border-b-8 border-indigo-800 relative overflow-hidden">
                    <div class="relative z-10">
                        <p class="text-[10px] font-black opacity-60 uppercase tracking-widest mb-1">JLPT 2026 Countdown</p>
                        <div class="text-8xl font-black mb-6" id="cD">--</div>
                        <p class="text-sm italic border-l-2 border-indigo-400 pl-4 py-1" id="mT">"æ‹…å¾—èµ·è´£ä»»äºŒå­—ã€‚"</p>
                    </div>
                    <div class="mt-8 bg-black/20 p-5 rounded-2xl relative z-10">
                        <p class="text-[10px] font-black mb-1 uppercase text-indigo-200">ä»Šæ—¥ç†æ€§å»ºè®®</p>
                        <p id="tT" class="text-xs font-bold leading-relaxed">å±è”½æƒ…ç»ªè¯¯å¯¼ï¼Œç”¨ç†æ€§æ¥çœ‹å¾…æ‰€æœ‰äº‹æƒ…ã€‚</p>
                    </div>
                    <div class="absolute -right-10 -bottom-10 text-[12rem] opacity-10 font-black rotate-12">G</div>
                </div>

                <div class="bg-white p-10 rounded-[3rem] shadow-xl border border-slate-100 flex flex-col justify-center">
                    <h3 class="font-black text-xl mb-6">é…ç½®ä»»åŠ¡ç¯å¢ƒ</h3>
                    
                    <div class="mb-6 space-y-3">
                        <label class="text-[10px] font-black text-slate-400 uppercase">é€‰æ‹©è®­ç»ƒæ¨¡å¼</label>
                        <div class="flex space-x-2">
                            <button id="mQ" onclick="sMode('quick')" class="flex-1 py-3 rounded-xl font-bold text-sm bg-slate-100 transition">æé€Ÿæ¨¡å¼</button>
                            <button id="mD" onclick="sMode('deep')" class="flex-1 py-3 rounded-xl font-bold text-sm bg-slate-100 transition">æ·±åº¦æ¨¡å¼</button>
                        </div>
                    </div>

                    <label class="flex-grow flex flex-col items-center justify-center border-4 border-dashed border-slate-100 rounded-[2.5rem] hover:border-indigo-400 transition cursor-pointer p-8 group">
                        <input type="file" id="fI" class="hidden" accept=".xlsx, .xls" />
                        <span class="text-5xl mb-3 group-hover:scale-110 transition">ğŸ“‚</span>
                        <span class="font-black text-slate-800">å¯¼å…¥ A:è¯ B:è¯»éŸ³ C:å«ä¹‰</span>
                        <p class="text-[9px] text-slate-400 mt-2 font-bold uppercase">æ”¯æŒ 805 æ ¸å¿ƒè¯è¡¨æ ¼å¼</p>
                    </label>
                </div>
            </div>
        </div>

        <div id="sS" class="hidden w-full max-w-xl animate-in zoom-in duration-300">
            <div class="flex justify-between items-center mb-6">
                <button onclick="location.reload()" class="bg-white px-4 py-2 rounded-xl shadow-sm text-[10px] font-black text-slate-500 hover:text-indigo-600">â† è¿”å›é¦–é¡µ</button>
                <div class="flex space-x-2">
                    <button id="smQ" onclick="sMode('quick')" class="px-3 py-1 text-[10px] font-bold rounded-lg bg-slate-200">æé€Ÿ</button>
                    <button id="smD" onclick="sMode('deep')" class="px-3 py-1 text-[10px] font-bold rounded-lg bg-slate-200">æ·±åº¦</button>
                </div>
            </div>

            <div class="bg-white rounded-[3.5rem] shadow-2xl min-h-[500px] flex flex-col relative border border-slate-50 overflow-hidden">
                <div id="pB" class="absolute top-0 left-0 h-2 bg-indigo-500 transition-all duration-500" style="width: 0%"></div>
                
                <div class="p-12 text-center flex-grow flex flex-col justify-center">
                    <p id="pos" class="text-[10px] font-black text-slate-300 mb-4 tracking-widest">0 / 0</p>
                    <h2 id="qT" class="text-4xl md:text-5xl font-black text-slate-800 mb-12 leading-tight">åŠ è½½ä¸­...</h2>

                    <div class="space-y-6 max-w-xs mx-auto w-full">
                        <input type="text" id="in1" class="w-full border-b-4 border-slate-100 py-3 text-3xl focus:outline-none focus:border-indigo-500 text-center font-bold" placeholder="..." autocomplete="off">
                        <input type="text" id="in2" class="hidden w-full border-b-4 border-slate-100 py-3 text-3xl focus:outline-none focus:border-indigo-500 text-center font-bold" placeholder="è¾“å…¥æ±‰å­—" autocomplete="off">
                        <p id="fB" class="text-[11px] font-black mt-4 h-4"></p>
                    </div>
                </div>

                <div class="p-8 bg-slate-50">
                    <button id="mainBtn" onclick="ctrl()" class="w-full bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-lg active:scale-95 transition text-lg">éªŒè¯ (Enter)</button>
                </div>
            </div>
        </div>
    </main>

    <div id="nbM" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[100] p-4">
        <div class="bg-white rounded-[2.5rem] w-full max-w-xl max-h-[80vh] flex flex-col shadow-2xl overflow-hidden">
            <div class="p-6 bg-slate-50 border-b flex justify-between font-black"><span>ğŸ“• ç”Ÿè¯èµ„äº§</span><button onclick="toggleM('nbM')">âœ•</button></div>
            <div id="nbL" class="p-4 overflow-y-auto flex-grow space-y-2"></div>
            <div class="p-6 border-t bg-slate-50"><button onclick="quickStart('nb')" class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl shadow-lg">âš”ï¸ å¼€å§‹çªå‡»å¤ä¹ </button></div>
        </div>
    </div>

    <div id="sbM" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[100] p-4">
        <div class="bg-white rounded-[2.5rem] w-full max-w-xl max-h-[80vh] flex flex-col border-4 border-slate-800 overflow-hidden shadow-2xl">
            <div class="p-6 bg-slate-800 text-white flex justify-between font-black"><span>â˜ ï¸ é¡½å›ºè®°å¿†</span><button onclick="toggleM('sbM')">âœ•</button></div>
            <div id="sbL" class="p-4 overflow-y-auto flex-grow space-y-2"></div>
            <div class="p-6 bg-slate-100"><button onclick="quickStart('sb')" class="w-full bg-slate-800 text-white font-black py-4 rounded-2xl shadow-lg">âš”ï¸ ç«‹å³æ¸…å‰¿</button></div>
        </div>
    </div>

    <script>
        let q = [], idx = 0, cur = null, mode = 'deep', state = 'input';
        let nb = JSON.parse(localStorage.getItem('gina_nb')) || JSON.parse(localStorage.getItem('gina_vocab_notebook')) || [];
        let sb = JSON.parse(localStorage.getItem('gina_sb')) || JSON.parse(localStorage.getItem('gina_stubborn_notebook')) || [];
        const tips = ["æ‰§è¡Œç›®æ ‡ï¼Œè€Œä¸æ˜¯ä¸€ç›´åœ¨è®¡åˆ’ç›®æ ‡ã€‚", "å…ˆéš¾åæ˜“ï¼Œè§£å†³é—®é¢˜ã€‚", "å±è”½æƒ…ç»ªçš„è¯¯å¯¼ï¼Œç”¨ç†æ€§çœ‹å¾…ã€‚", "æ‹…å¾—èµ·è´£ä»»äºŒå­—ã€‚", "ä¸è¦è‡ªå‘ã€‚"];

        window.onload = () => {
            const d = Math.ceil((new Date('2026-07-05') - new Date()) / (1000*60*60*24));
            document.getElementById('cD').innerText = d > 0 ? d : "GO!";
            document.getElementById('mT').innerText = tips[Math.floor(Math.random()*tips.length)];
            document.getElementById('tT').innerText = tips[Math.floor(Math.random()*tips.length)];
            updateUI(); sMode('deep');
        };

        // æ–‡ä»¶ä¸Šä¼ 
        document.getElementById('fI').onchange = (e) => {
            const r = new FileReader();
            r.onload = (ev) => {
                const data = XLSX.utils.sheet_to_json(XLSX.read(new Uint8Array(ev.target.result), {type:'array'}).Sheets[XLSX.read(new Uint8Array(ev.target.result), {type:'array'}).SheetNames[0]], {header:1});
                q = data.slice(1).map(r => {
                    let w=String(r[0]||"").trim(), rd=String(r[1]||"").trim(), m=String(r[2]||"").trim();
                    if(!w) return null;
                    return { w, rd: /[\u4E00-\u9FAF]/.test(w)?rd:w, m: m||rd, isK: /[\u4E00-\u9FAF]/.test(w) };
                }).filter(x => x);
                if(q.length) { q.sort(()=>Math.random()-0.5); idx=0; go(); }
            };
            r.readAsArrayBuffer(e.target.files[0]);
        };

        function go() {
            document.getElementById('hS').classList.add('hidden');
            document.getElementById('sS').classList.remove('hidden');
            load();
        }

        function load() {
            if(idx >= q.length) { 
                document.getElementById('sS').innerHTML = "<div class='bg-white p-12 rounded-[3.5rem] text-center shadow-2xl'><div class='text-6xl mb-6'>ğŸ¯</div><h2 class='text-2xl font-black mb-6'>æ‰§è¡Œå®Œæ¯•ï¼</h2><button onclick='location.reload()' class='bg-indigo-600 text-white px-10 py-3 rounded-2xl font-black'>å›åˆ°é¦–é¡µ</button></div>";
                return; 
            }
            cur = q[idx]; state = 'input';
            document.getElementById('qT').innerText = cur.m;
            document.getElementById('pos').innerText = `${idx + 1} / ${q.length}`;
            document.getElementById('pB').style.width = (idx/q.length*100) + '%';
            
            document.getElementById('in1').value = ''; document.getElementById('in2').value = '';
            document.getElementById('in1').disabled = false;
            document.getElementById('in2').classList.add('hidden');
            document.getElementById('fB').innerText = '';
            document.getElementById('mainBtn').innerText = "éªŒè¯ (Enter)";
            document.getElementById('mainBtn').className = "w-full bg-indigo-600 text-white font-black py-5 rounded-2xl shadow-lg transition text-lg";
            
            document.getElementById('in1').placeholder = (mode==='deep' && cur.isK) ? "è¾“å…¥è¯»éŸ³" : "è¾“å…¥å•è¯";
            setTimeout(()=>document.getElementById('in1').focus(), 50);
        }

        function ctrl() {
            if(state === 'next') { load(); return; }
            const v1 = document.getElementById('in1').value.trim().toLowerCase();
            const v2 = document.getElementById('in2').value.trim().toLowerCase();
            const isS2 = !document.getElementById('in2').classList.contains('hidden');

            if(!isS2) {
                let target = (mode==='deep' && cur.isK) ? cur.rd : cur.w;
                if(v1 === target.toLowerCase()) {
                    if(mode==='deep' && cur.isK) {
                        document.getElementById('in2').classList.remove('hidden');
                        document.getElementById('in1').disabled = true;
                        document.getElementById('in2').focus();
                        msg("âœ“ è¯»éŸ³æ­£ç¡®ï¼Œå†™å‡ºæ±‰å­—", "text-indigo-600");
                    } else { pass(); }
                } else { fail(target); }
            } else {
                if(v2 === cur.w.toLowerCase()) pass(); else fail(cur.w);
            }
        }

        function pass() {
            msg("ğŸ‰ æ­£ç¡®", "text-emerald-500");
            state = 'next'; idx++;
            document.getElementById('mainBtn').innerText = "ä¸‹ä¸€ä¸ª (Enter)";
            document.getElementById('mainBtn').className = "w-full bg-emerald-500 text-white font-black py-5 rounded-2xl shadow-lg transition text-lg";
        }

        function fail(t) {
            msg(`âŒ é”™è¯¯ (æç¤º: ${t})`, "text-red-500");
            if(!nb.find(x=>x.w===cur.w)) { nb.unshift(cur); save(); updateUI(); }
        }

        function msg(t, c) { const e=document.getElementById('fB'); e.innerText=t; e.className=`text-[11px] font-black mt-4 h-4 ${c}`; }

        function sMode(m) {
            mode = m;
            ['mQ','mD','smQ','smD'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.classList.toggle('active-mode', id.toLowerCase().includes(m[0]));
            });
            if(cur) load();
        }

        function updateUI() {
            document.getElementById('nC').innerText = nb.length;
            document.getElementById('sC').innerText = sb.length;
            render('nbL', nb, 'nb'); render('sbL', sb, 'sb');
        }

        function render(id, data, t) {
            const box = document.getElementById(id); box.innerHTML = '';
            data.forEach((x, i) => {
                const d = document.createElement('div');
                d.className = "flex justify-between items-center p-3 bg-slate-50 rounded-xl border";
                d.innerHTML = `<div><b class='text-sm'>${x.w}</b> <span class='text-[10px] opacity-40'>${x.rd}</span><p class='text-[10px] opacity-60'>${x.m}</p></div>
                               <button onclick="del(${i},'${t}')" class="text-indigo-600 font-bold text-xs">æŒæ¡</button>`;
                box.appendChild(d);
            });
        }

        function del(i,t) { if(t==='nb') nb.splice(i,1); else sb.splice(i,1); save(); updateUI(); }
        function save() { localStorage.setItem('gina_nb', JSON.stringify(nb)); }
        function toggleM(id) { document.getElementById(id).classList.toggle('hidden'); }
        function quickStart(t) { 
            let d = (t==='nb')?nb:sb; if(!d.length) return;
            q = [...d].sort(()=>Math.random()-0.5); idx=0; toggleM(t+'M'); go(); 
        }

        document.onkeydown = (e) => { if(e.key === 'Enter') ctrl(); };
    </script>
</body>
</html>
